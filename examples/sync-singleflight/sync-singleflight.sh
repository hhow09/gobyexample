$go run sync-singleflight.go
# default query: every query goes to db
===default query===
query db
query db
query db
query db
query db
query db
query db
query db
query db
query db
2023/01/24 12:24:19 
2023/01/24 12:24:19 
2023/01/24 12:24:19 
2023/01/24 12:24:19 
2023/01/24 12:24:19 
2023/01/24 12:24:19 
2023/01/24 12:24:19 
2023/01/24 12:24:19 
2023/01/24 12:24:19 
2023/01/24 12:24:19 

# only one query goes to db.
# others goroutine will use that result.
===wrap query with singleflight===
query db
2023/01/24 12:24:19 1674534259333265000
2023/01/24 12:24:19 1674534259333265000
2023/01/24 12:24:19 1674534259333265000
2023/01/24 12:24:19 1674534259333265000
2023/01/24 12:24:19 1674534259333265000
2023/01/24 12:24:19 1674534259333265000
2023/01/24 12:24:19 1674534259333265000
2023/01/24 12:24:19 1674534259333265000
2023/01/24 12:24:19 1674534259333265000
2023/01/24 12:24:19 1674534259333265000